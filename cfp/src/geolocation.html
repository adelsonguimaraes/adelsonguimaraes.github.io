<!DOCTYPE html>
<html>
<header>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
</header>
<body>
<p id="demo">Clique no botão para obter sua localização:</p>
<button onclick="getLocation()">Clique aqui</button>
<!-- <button onClick="localizarUsuario()">Minha Localização</button> <br> -->

<div id="mapholder"></div>
<script src="https://maps.google.com/maps/api/js?key=AIzaSyDz6MK5RAxChbfU8A4CuraLMkDDiIQoTk8"></script>
<script>
var x=document.getElementById("demo");
function getLocation() {
  if (navigator.geolocation) {
    var options = {
      enableHighAccuracy: true,
      timeout: 5000,
      maximumAge: 0
    };

    navigator.geolocation.getCurrentPosition(showPosition, showError, options);
  }else{
    x.innerHTML="Geolocalização não é suportada nesse browser.";
  }
}
 
function showPosition(position) {
  var latLocal = '-3.106951';
  var lonLocal = '-60.020758';

    if (position.coords.latitude === latLocal && position.coords.longitude === lonLocal) {
      x.innerHTML = "Você está na AKTO.";
      console.log('Você está na AKTO');
    }

  lat=position.coords.latitude;
  lon=position.coords.longitude;

  var distancia = getDistanceFromLatLonInKm(
    { lat: latLocal, lng: lonLocal },
    { lat: lat, lng: lon }
  );

  console.log(distancia);

  latlon=new google.maps.LatLng(lat, lon)
  mapholder=document.getElementById('mapholder')
  mapholder.style.height='250px';
  mapholder.style.width='500px';
 
  var myOptions={
  center:latlon,zoom:14,
  mapTypeId:google.maps.MapTypeId.ROADMAP,
  mapTypeControl:false,
  navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}
  };
  var map=new google.maps.Map(document.getElementById("mapholder"),myOptions);
  var marker=new google.maps.Marker({position:latlon,map:map,title:"Você está Aqui!", icon: '../libs/img/worker-icon.png'});
  var circulo = new google.maps.Circle({
    map: map,
    center: new google.maps.LatLng(latLocal, lonLocal),
    radius: 20, // 1000 metros = 1k.
    strokeColor: "#0000FF",
    strokeOpacity: 0.8,
    strokeWeight: 2,
    fillColor: "#0000FF",
    fillOpacity: 0.4
  });

  }
 
function showError(error)
  {
  switch(error.code)
    {
    case error.PERMISSION_DENIED:
      x.innerHTML="Usuário rejeitou a solicitação de Geolocalização."
      break;
    case error.POSITION_UNAVAILABLE:
      x.innerHTML="Localização indisponível."
      break;
    case error.TIMEOUT:
      x.innerHTML="O tempo da requisição expirou."
      break;
    case error.UNKNOWN_ERROR:
      x.innerHTML="Algum erro desconhecido aconteceu."
      break;
    }
  }
  function localizarUsuario(){
  if (window.navigator && window.navigator.geolocation) {
   var geolocation = window.navigator.geolocation;
   geolocation.getCurrentPosition(sucesso, erro);
  } else {
     alert('Geolocalização não suportada em seu navegador.')
  }
  function sucesso(posicao){
    console.log(posicao);
    var latitude = posicao.coords.latitude;
    var longitude = posicao.coords.longitude;
    alert('Sua latitude estimada é: ' + latitude + ' e longitude: ' + longitude )
  }
  function erro(error){
    console.log(error)
  }
}

// calulando distancia entre duas coordenadas
function getDistanceFromLatLonInKm(position1, position2) {
  "use strict";
  var deg2rad = function (deg) { return deg * (Math.PI / 180); },
    R = 6371,
    dLat = deg2rad(position2.lat - position1.lat),
    dLng = deg2rad(position2.lng - position1.lng),
    a = Math.sin(dLat / 2) * Math.sin(dLat / 2)
      + Math.cos(deg2rad(position1.lat))
      * Math.cos(deg2rad(position1.lat))
      * Math.sin(dLng / 2) * Math.sin(dLng / 2),
    c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return ((R * c * 1000).toFixed());
}


</script>
</body>
</html>